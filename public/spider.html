<!DOCTYPE html>
<html>
<head>
    <title>Spider Chart</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body>
    <div id="search-container">
        <input type="text" id="player-search" placeholder="Enter player name">
        <div id="player-list-container">
            <div id="player-list"></div>
        </div>
        <div id="selected-player"></div>
    </div>
    <div id="search-container2">
        <input type="text" id="player-search2" placeholder="Enter player name">
        <div id="player-list-container2">
            <div id="player-list2"></div>
        </div>
        <div id="selected-player2"></div>
    </div>
    <div id="main-container">
        <div id="player-grid">
            <div id="gameweek01" class="player-box">GW1</div>
            <div id="gameweek02" class="player-box">GW2</div>
            <div id="gameweek03" class="player-box">GW3</div>
            <div id="gameweek04" class="player-box">GW4</div>
            <div id="gameweek05" class="player-box">GW5</div>
            <div id="gameweek06" class="player-box">GW6</div>
            <div id="gameweek07" class="player-box">GW7</div>
            <div id="gameweek08" class="player-box">GW8</div>
            <div id="gameweek09" class="player-box">GW9</div>
            <div id="gameweek10" class="player-box">GW10</div>
            <div id="gameweek11" class="player-box">GW11</div>
            <div id="gameweek12" class="player-box">GW12</div>
        </div>
        <div id="player-grid2">
            <div id="gameweek13" class="player-box">GW1</div>
            <div id="gameweek14" class="player-box">GW2</div>
            <div id="gameweek15" class="player-box">GW3</div>
            <div id="gameweek16" class="player-box">GW4</div>
            <div id="gameweek17" class="player-box">GW5</div>
            <div id="gameweek18" class="player-box">GW6</div>
            <div id="gameweek19" class="player-box">GW7</div>
            <div id="gameweek20" class="player-box">GW8</div>
            <div id="gameweek21" class="player-box">GW9</div>
            <div id="gameweek22" class="player-box">GW10</div>
            <div id="gameweek23" class="player-box">GW11</div>
            <div id="gameweek24" class="player-box">GW12</div>
        </div>
    </div>
    <div id="chart"></div>
    <select id="feature-select">
        <option value="assists">Assists</option>
        <option value="goals_scored">Goals Scored</option>
        <option value="expected_assists">Expected Assists</option>
        <option value="expected_goals">Expected Goals</option>
        <option value="bonus">Bonus</option>
    </select>
    <div id="features-container">
        <table id="feature-table">
            <thead>
                <tr>
                    <th>Feature</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    <link rel="stylesheet" href="style.css">
    <script src="js/spider.js"></script>
    <div id="chart"></div>
    <script>
        // Configuration
        var config = {
            w: 400,
            h: 300,
            maxValue: 1,
            levels: 5,
            ExtraWidthX: 100
        };

        var data = [];
        var filteredData = [];

        var data2 = [];
        var filteredData2 = [];

        // Load the CSV file
        d3.csv("../data/individual_gw.csv").then(function(csvData) {
            var playerSearch = document.getElementById('player-search');
            var playerList = document.getElementById('player-list');
            var selectedPlayer = document.getElementById('selected-player');

            var playerSearch2 = document.getElementById('player-search2');
            var playerList2 = document.getElementById('player-list2');
            var selectedPlayer2 = document.getElementById('selected-player2');


            playerSearch.addEventListener('input', function() {
                var searchValue = playerSearch.value.toLowerCase();

                // Filter the data to only include the players whose names start with the search value
                var matchingPlayers = csvData.filter(function(row) {
                    return row['name'].toLowerCase().includes(searchValue);
                });

                // Get the unique player names
                var uniquePlayerNames = [...new Set(matchingPlayers.map(player => player['name']))];

                // Clear the player list
                playerList.innerHTML = '';

                // Add the unique player names to the player list
                uniquePlayerNames.forEach(function(playerName) {
                    var playerItem = document.createElement('div');
                    playerItem.textContent = playerName;

                    var selectButton = document.createElement('button');
                    selectButton.textContent = 'Select';
                    selectButton.addEventListener('click', function() {
                        // When the select button is clicked, draw the spider chart for that player

                        // Filter the data to only include the rows for the selected player
                        filteredData = csvData.filter(function(row) {
                            return row['name'] === playerName;
                        });

                        // Map the filtered data to the format expected by the drawSpiderChart function
                        data = [
                            {axis: 'assists', value: filteredData.map(function(row) {return parseInt(row['assists']);})},
                            {axis: 'goals_scored', value: filteredData.map(function(row) {return parseInt(row['goals_scored']);})},
                            {axis: 'expected_assists', value: filteredData.map(function(row) {return parseFloat(row['expected_assists']);})},
                            {axis: 'expected_goals', value: filteredData.map(function(row) {return parseFloat(row['expected_goals']);})},
                            {axis: 'bonus', value: filteredData.map(function(row) {return parseInt(row['bonus']);})}
                        ];

                        // Call the drawSpiderChart function with the mapped data
                        drawSpiderChart("#chart", data, data2, config);
                        // Add this inside the selectButton click event listener, after the drawSpiderChart function call
                        var selectedPlayer = document.getElementById('selected-player');
                        selectedPlayer.textContent = 'Selected player: ' + playerName;

                        // Clear the search bar and hide the player list
                        playerSearch.value = '';
                        playerList.innerHTML = '';
                    });

                    playerItem.appendChild(selectButton);
                    playerList.appendChild(playerItem);
                });
            });

            playerSearch2.addEventListener('input', function() {
                var searchValue = playerSearch2.value.toLowerCase();

                // Filter the data to only include the players whose names start with the search value
                var matchingPlayers = csvData.filter(function(row) {
                    return row['name'].toLowerCase().includes(searchValue);
                });

                // Get the unique player names
                var uniquePlayerNames = [...new Set(matchingPlayers.map(player => player['name']))];

                // Clear the player list
                playerList2.innerHTML = '';

                // Add the unique player names to the player list
                uniquePlayerNames.forEach(function(playerName) {
                    var playerItem = document.createElement('div');
                    playerItem.textContent = playerName;

                    var selectButton = document.createElement('button');
                    selectButton.textContent = 'Select';
                    selectButton.addEventListener('click', function() {
                        // When the select button is clicked, draw the spider chart for that player

                        // Filter the data to only include the rows for the selected player
                        var filteredData2 = csvData.filter(function(row) {
                            return row['name'] === playerName;
                        });

                        // Map the filtered data to the format expected by the drawSpiderChart function
                        data2 = [
                            {axis: 'assists', value: filteredData2.map(function(row) {return parseInt(row['assists']);})},
                            {axis: 'goals_scored', value: filteredData2.map(function(row) {return parseInt(row['goals_scored']);})},
                            {axis: 'expected_assists', value: filteredData2.map(function(row) {return parseFloat(row['expected_assists']);})},
                            {axis: 'expected_goals', value: filteredData2.map(function(row) {return parseFloat(row['expected_goals']);})},
                            {axis: 'bonus', value: filteredData2.map(function(row) {return parseInt(row['bonus']);})}
                        ];

                        // Call the drawSpiderChart function with the mapped data
                        drawSpiderChart("#chart", data, data2, config);

                        selectedPlayer2.textContent = 'Selected player: ' + playerName;

                        // Clear the search bar and hide the player list
                        playerSearch2.value = '';
                        playerList2.innerHTML = '';
                    });

                    playerItem.appendChild(selectButton);
                    playerList2.appendChild(playerItem);
                });
            });
        }).catch(function(error) {
            console.log(error);
        });
    </script>
</body>
</html>