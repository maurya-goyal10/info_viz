<!DOCTYPE html>
<html>
<head>
    <title>FPL PLAYER COMPARISON</title>
    <style></style>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <!-- BOOTSTRAP  -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>
<body>
    <nav class="navbar navbar-inverse technav">
        <div class="container-fluid">
            <div class="navbar-header">
                <a href="./index.html" class="navbar-brand">Home Page</a>
            </div>
            <ul class="navbar-nav nav">
                <li> <a href="./spider.html" class="nav-item">Player Comparison</a></li>
            </ul>
        </div>
    </nav>
    <div id="search-container">
        <input type="text" id="player-search" placeholder="Enter player name">
        <div id="player-list-container">
            <div id="player-list"></div>
        </div>
        <div id="selected-player"></div>
    </div>
    <div id="search-container2">
        <input type="text" id="player-search2" placeholder="Enter player name">
        <div id="player-list-container2">
            <div id="player-list2"></div>
        </div>
        <div id="selected-player2"></div>
    </div>
    <div id="main-container">
        <button id="select-all-button-1">Select All GWs</button>
        <button id="unselect-all-button-1">Clear GWs</button>
        <div id="player-grid">
            <div id="gameweek01" class="player-box">GW1</div>
            <div id="gameweek02" class="player-box">GW2</div>
            <div id="gameweek03" class="player-box">GW3</div>
            <div id="gameweek04" class="player-box">GW4</div>
            <div id="gameweek05" class="player-box">GW5</div>
            <div id="gameweek06" class="player-box">GW6</div>
            <div id="gameweek07" class="player-box">GW7</div>
            <div id="gameweek08" class="player-box">GW8</div>
            <div id="gameweek09" class="player-box">GW9</div>
            <div id="gameweek10" class="player-box">GW10</div>
            <div id="gameweek11" class="player-box">GW11</div>
            <div id="gameweek12" class="player-box">GW12</div>
        </div>
        <button id="select-all-button-2">Select All GWs</button>
        <button id="unselect-all-button-2">Clear GWs</button>
        <div id="player-grid2">
            <div id="gameweek13" class="player-box">GW1</div>
            <div id="gameweek14" class="player-box">GW2</div>
            <div id="gameweek15" class="player-box">GW3</div>
            <div id="gameweek16" class="player-box">GW4</div>
            <div id="gameweek17" class="player-box">GW5</div>
            <div id="gameweek18" class="player-box">GW6</div>
            <div id="gameweek19" class="player-box">GW7</div>
            <div id="gameweek20" class="player-box">GW8</div>
            <div id="gameweek21" class="player-box">GW9</div>
            <div id="gameweek22" class="player-box">GW10</div>
            <div id="gameweek23" class="player-box">GW11</div>
            <div id="gameweek24" class="player-box">GW12</div>
        </div>
    </div>
    <div id="chart"></div>
    <select id="feature-select">
        <option value="assists">Assists</option>
        <option value="goals_scored">Goals Scored</option>
        <option value="expected_assists">Expected Assists</option>
        <option value="expected_goals">Expected Goals</option>
        <option value="bonus">Bonus</option>
    </select>
    <div id="features-container">

        <div id="features-list"></div>
        
    </div>
    <link rel="stylesheet" href="style_1.css">
    <script src="js/spider.js"></script>
    <div id="chart"></div>
    <script>
        // Configuration
        var config = {
            w: 500,
            h: 400,
            maxValue: 1,
            levels: 5,
            ExtraWidthX: 0,
            ExtraHeightY: 0
        };

        var data = [];
        var filteredData = [];
        var gw1 = [];
        var player1 = "";

        var data2 = [];
        var filteredData2 = [];
        var gw2 = [];
        var player2 = "";

        // Load the CSV file
        d3.csv("../data/individual_gw.csv").then(function(csvData) {
            var playerSearch = document.getElementById('player-search');
            var playerList = document.getElementById('player-list');
            var selectedPlayer = document.getElementById('selected-player');

            var playerSearch2 = document.getElementById('player-search2');
            var playerList2 = document.getElementById('player-list2');
            var selectedPlayer2 = document.getElementById('selected-player2');


            playerSearch.addEventListener('input', function() {
                var searchValue = playerSearch.value.toLowerCase();

                // Filter the data to only include the players whose names start with the search value
                var matchingPlayers = csvData.filter(function(row) {
                    return row['name'].toLowerCase().includes(searchValue);
                });

                // Get the unique player names
                var uniquePlayerNames = [...new Set(matchingPlayers.map(player => player['name']))];

                // Clear the player list
                playerList.innerHTML = '';

                if (csvData.length != matchingPlayers.length) {
                // Add the unique player names to the player list
                uniquePlayerNames.forEach(function(playerName) {
                    var playerItem = document.createElement('div');
                    playerItem.textContent = playerName;

                    var selectButton = document.createElement('button');
                    selectButton.textContent = 'Select';
                    selectButton.addEventListener('click', function() {
                        // When the select button is clicked, draw the spider chart for that player
                        player1 = playerName;
                        // Filter the data to only include the rows for the selected player
                        filteredData = csvData.filter(function(row) {
                            return row['name'] === playerName;
                        });

                        // Map the filtered data to the format expected by the drawSpiderChart function
                        data = [
                            {axis: 'assists', value: filteredData.map(function(row) {return parseInt(row['assists']);})},
                            {axis: 'goals_scored', value: filteredData.map(function(row) {return parseInt(row['goals_scored']);})},
                            {axis: 'expected_assists', value: filteredData.map(function(row) {return parseFloat(row['expected_assists']);})},
                            {axis: 'expected_goals', value: filteredData.map(function(row) {return parseFloat(row['expected_goals']);})},
                            {axis: 'bonus', value: filteredData.map(function(row) {return parseInt(row['bonus']);})}
                        ];

                        gw1 = [
                            {axis: 'opponent', value: filteredData.map(function(row) {return parseInt(row['opponent_team']);})},
                            {axis: 'ishome', value: filteredData.map(function(row) {return (row['was_home']);})}
                        ];

                        // Get all player boxes
                        var playerBoxes = document.getElementsByClassName('player-box');
                        // Find the object where axis is 'ishome'
                        var ishomeObject = gw1.find(function(d) { return d.axis === 'ishome'; });
                        console.log(ishomeObject.value);
                        var opponentObject = gw1.find(function(d) { return d.axis === 'opponent'; });

                        // Replace the content of each player box with the corresponding data
                        for (var i = 0; i < playerBoxes.length/2; i++) {
                            
                            
                            var home = "(H)";
                            if (ishomeObject.value[i] == 'False') {
                                home = "(A)";
                            };

                            var opponent = "Error";

                            if (opponentObject.value[i] == 1) {
                                opponent = "ARS";
                            };
                            if (opponentObject.value[i] == 2) {
                                opponent = "AVL";
                            };
                            if (opponentObject.value[i] == 3) {
                                opponent = "BOU";
                            };
                            if (opponentObject.value[i] == 4) {
                                opponent = "BRE";
                            };
                            if (opponentObject.value[i] == 5) {
                                opponent = "BHA";
                            };
                            if (opponentObject.value[i] == 6) {
                                opponent = "BUR";
                            };
                            if (opponentObject.value[i] == 7) {
                                opponent = "CHE";
                            };
                            if (opponentObject.value[i] == 8) {
                                opponent = "CRY";
                            };
                            if (opponentObject.value[i] == 9) {
                                opponent = "EVE";
                            };
                            if (opponentObject.value[i] == 10) {
                                opponent = "FUL";
                            };
                            if (opponentObject.value[i] == 11) {
                                opponent = "LIV";
                            };
                            if (opponentObject.value[i] == 12) {
                                opponent = "LUT";
                            };
                            if (opponentObject.value[i] == 13) {
                                opponent = "MCI";
                            };
                            if (opponentObject.value[i] == 14) {
                                opponent = "MUN";
                            };
                            if (opponentObject.value[i] == 15) {
                                opponent = "NEW";
                            };
                            if (opponentObject.value[i] == 16) {
                                opponent = "NFO";
                            };
                            if (opponentObject.value[i] == 17) {
                                opponent = "SHU";
                            };
                            if (opponentObject.value[i] == 18) {
                                opponent = "TOT";
                            };
                            if (opponentObject.value[i] == 19) {
                                opponent = "WHU";
                            };
                            if (opponentObject.value[i] == 20) {
                                opponent = "WOL";
                            };

                            playerBoxes[i].textContent = opponent + home;
                        }

                        // Call the drawSpiderChart function with the mapped data
                        drawSpiderChart("#chart", data, data2, config, 1, player1, player2);
                        // Add this inside the selectButton click event listener, after the drawSpiderChart function call
                        var selectedPlayer = document.getElementById('selected-player');
                        selectedPlayer.textContent = 'Selected player: ' + playerName;

                        // Clear the search bar and hide the player list
                        playerSearch.value = '';
                        playerList.innerHTML = '';
                    });

                    playerItem.appendChild(selectButton);
                    playerList.appendChild(playerItem);
                });}
            });

            playerSearch2.addEventListener('input', function() {
                var searchValue = playerSearch2.value.toLowerCase();

                // Filter the data to only include the players whose names start with the search value
                var matchingPlayers = csvData.filter(function(row) {
                    return row['name'].toLowerCase().includes(searchValue);
                });

                // Get the unique player names
                var uniquePlayerNames = [...new Set(matchingPlayers.map(player => player['name']))];

                // Clear the player list
                playerList2.innerHTML = '';

                if (csvData.length != matchingPlayers.length) {
                // Add the unique player names to the player list
                uniquePlayerNames.forEach(function(playerName) {
                    var playerItem = document.createElement('div');
                    playerItem.textContent = playerName;

                    var selectButton = document.createElement('button');
                    selectButton.textContent = 'Select';
                    selectButton.addEventListener('click', function() {
                        // When the select button is clicked, draw the spider chart for that player
                        player2 = playerName;

                        // Filter the data to only include the rows for the selected player
                        var filteredData2 = csvData.filter(function(row) {
                            return row['name'] === playerName;
                        });

                        // Map the filtered data to the format expected by the drawSpiderChart function
                        data2 = [
                            {axis: 'assists', value: filteredData2.map(function(row) {return parseInt(row['assists']);})},
                            {axis: 'goals_scored', value: filteredData2.map(function(row) {return parseInt(row['goals_scored']);})},
                            {axis: 'expected_assists', value: filteredData2.map(function(row) {return parseFloat(row['expected_assists']);})},
                            {axis: 'expected_goals', value: filteredData2.map(function(row) {return parseFloat(row['expected_goals']);})},
                            {axis: 'bonus', value: filteredData2.map(function(row) {return parseInt(row['bonus']);})}
                        ];

                        gw2 = [
                            {axis: 'opponent', value: filteredData2.map(function(row) {return parseInt(row['opponent_team']);})},
                            {axis: 'ishome', value: filteredData2.map(function(row) {return (row['was_home']);})}
                        ];

                        // Get all player boxes
                        var playerBoxes = document.getElementsByClassName('player-box');
                        // Find the object where axis is 'ishome'
                        var ishomeObject = gw2.find(function(d) { return d.axis === 'ishome'; });
                        console.log(ishomeObject.value);
                        var opponentObject = gw2.find(function(d) { return d.axis === 'opponent'; });

                        // Replace the content of each player box with the corresponding data
                        for (var i = 0; i < playerBoxes.length/2; i++) {
                            
                            
                            var home = "(H)";
                            if (ishomeObject.value[i] == 'False') {
                                home = "(A)";
                            };

                            var opponent = "Error";

                            if (opponentObject.value[i] == 1) {
                                opponent = "ARS";
                            };
                            if (opponentObject.value[i] == 2) {
                                opponent = "AVL";
                            };
                            if (opponentObject.value[i] == 3) {
                                opponent = "BOU";
                            };
                            if (opponentObject.value[i] == 4) {
                                opponent = "BRE";
                            };
                            if (opponentObject.value[i] == 5) {
                                opponent = "BHA";
                            };
                            if (opponentObject.value[i] == 6) {
                                opponent = "BUR";
                            };
                            if (opponentObject.value[i] == 7) {
                                opponent = "CHE";
                            };
                            if (opponentObject.value[i] == 8) {
                                opponent = "CRY";
                            };
                            if (opponentObject.value[i] == 9) {
                                opponent = "EVE";
                            };
                            if (opponentObject.value[i] == 10) {
                                opponent = "FUL";
                            };
                            if (opponentObject.value[i] == 11) {
                                opponent = "LIV";
                            };
                            if (opponentObject.value[i] == 12) {
                                opponent = "LUT";
                            };
                            if (opponentObject.value[i] == 13) {
                                opponent = "MCI";
                            };
                            if (opponentObject.value[i] == 14) {
                                opponent = "MUN";
                            };
                            if (opponentObject.value[i] == 15) {
                                opponent = "NEW";
                            };
                            if (opponentObject.value[i] == 16) {
                                opponent = "NFO";
                            };
                            if (opponentObject.value[i] == 17) {
                                opponent = "SHU";
                            };
                            if (opponentObject.value[i] == 18) {
                                opponent = "TOT";
                            };
                            if (opponentObject.value[i] == 19) {
                                opponent = "WHU";
                            };
                            if (opponentObject.value[i] == 20) {
                                opponent = "WOL";
                            };

                            playerBoxes[i+12].textContent = opponent + home;
                        }

                        // Call the drawSpiderChart function with the mapped data
                        drawSpiderChart("#chart", data, data2, config, 1, player1, player2);

                        selectedPlayer2.textContent = 'Selected player: ' + playerName;

                        // Clear the search bar and hide the player list
                        playerSearch2.value = '';
                        playerList2.innerHTML = '';
                    });

                    playerItem.appendChild(selectButton);
                    playerList2.appendChild(playerItem);
                });}
            });
        }).catch(function(error) {
            console.log(error);
        });
    </script>
</body>
</html>